"use strict";(self["webpackChunkonline_shop_frontend"]=self["webpackChunkonline_shop_frontend"]||[]).push([[323],{4323:function(e,s,t){t.r(s),t.d(s,{default:function(){return O}});var i=t(3396),n=t(7139),a=t(9242);const l=e=>((0,i.dD)("data-v-4775cb3e"),e=e(),(0,i.Cn)(),e),r={class:"chat flex-row justify-content-center align-items-center"},o={class:"chat-content"},c={class:"chat-online-list flex-row"},h={class:"w-full"},u=l((()=>(0,i._)("p",null,"目前在線：",-1))),g={class:"flex-row justify-content-around"},d={class:"chat-board flex-col",id:"chat-board"},m=["src"],w={key:0},p=["onClick"],f=["href"],v={key:1,class:"flex-row"},y={key:2},L=["onClick"],b={type:"text",ref:"sayInput",maxlength:"300",placeholder:"輸入訊息..."},_=l((()=>(0,i._)("button",null,"送出",-1)));function D(e,s,t,l,D,k){return(0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",o,[(0,i._)("div",c,[(0,i._)("div",h,[u,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(D.onlineList,(e=>((0,i.wg)(),(0,i.iD)("p",null,(0,n.zw)(e),1)))),256))]),(0,i._)("button",{class:"active-btn",onClick:s[0]||(s[0]=(...e)=>k.isOnlineListActive&&k.isOnlineListActive(...e))})]),(0,i._)("div",g,[(0,i._)("p",null,(0,n.zw)(D.broadcast),1),(0,i._)("p",null,"聊天室人數："+(0,n.zw)(D.onlineList.length),1)]),(0,i._)("div",d,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(D.message,((e,s)=>((0,i.wg)(),(0,i.iD)("div",{key:s,class:(0,n.C_)(D.username===e.username?"message flex-row reverse":"message flex-row")},[(0,i._)("img",{class:"message-avatar",src:e.avatar},null,8,m),(0,i._)("div",{class:(0,n.C_)(["flex-col",D.username===e.username?"align-items-end":"align-items-start"])},[(0,i._)("div",{class:(0,n.C_)(["message-username h4 flex-row",D.username===e.username?"reverse":""])},[(0,i._)("p",null,(0,n.zw)(e.username),1),e.isDate?((0,i.wg)(),(0,i.iD)("p",w,(0,n.zw)(e.date),1)):(0,i.kq)("",!0)],2),!0===e.hasURL?((0,i.wg)(),(0,i.iD)("div",{key:0,class:"message-text flex-row flex-wrap h3 cursor-ptr",onClick:s=>k.activeDate(e)},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.messageArray,(e=>((0,i.wg)(),(0,i.iD)("div",null,[k.isUrl(e)?((0,i.wg)(),(0,i.iD)("a",{key:0,href:e,target:"_blank",style:{color:"white"}},(0,n.zw)(e),9,f)):k.isSpace(e)?((0,i.wg)(),(0,i.iD)("div",v,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e,(e=>((0,i.wg)(),(0,i.iD)("p",null," ")))),256))])):((0,i.wg)(),(0,i.iD)("p",y,(0,n.zw)(e),1))])))),256))],8,p)):(0,i.kq)("",!0),!1===e.hasURL?((0,i.wg)(),(0,i.iD)("p",{key:1,class:"message-text h3 cursor-ptr",onClick:s=>k.activeDate(e)},(0,n.zw)(e.message),9,L)):(0,i.kq)("",!0)],2)],2)))),128))]),(0,i._)("form",{onSubmit:s[1]||(s[1]=(0,a.iM)(((...e)=>k.sendMessage&&k.sendMessage(...e)),["prevent"])),class:"chat-form flex-row"},[(0,i._)("input",b,null,512),_],32)])])}t(7658);var k=t(5704),x={name:"ChatView",data(){return{ws:null,username:"",onlineList:[],broadcast:"",message:[],hasURL:!1,scrollHeightTemp:0,activeList:!1}},methods:{isOnlineListActive(){this.activeList=!this.activeList,this.activeList?document.querySelector(".chat-online-list").style.transform="translateX(0)":document.querySelector(".chat-online-list").style.transform="translateX(-150px)"},isSpace(e){return" "===e[0]},isUrl(e){return/^https?:\/\/[^\s]+$/.test(e)},includeUrl(e){return/https?:\/\/[^\s]+/.test(e)},connection(){k.Z.commit("changeLoading",!0),this.ws=new WebSocket("wss://itdove.onrender.com"),this.ws.addEventListener("open",(()=>{k.Z.commit("changeLoading",!1)})),this.ws.addEventListener("message",(e=>{let s=Object.assign({},JSON.parse(e.data));if(-1===s.status)this.onlineList.splice(this.onlineList.indexOf(s.username),1),this.broadcast=s.message;else if(0===s.status)-1===this.onlineList.indexOf(s.username)&&this.onlineList.push(s.username),this.broadcast=s.message;else if(1===s.status)s.isDate=!1,s.hasURL=this.includeUrl(s.message),!0===s.hasURL&&(s.messageArray=s.message.split(/(https?:\/\/[^\s]+| +)/g)),this.message.push(s);else if(2===s.status){this.username=s.username,this.onlineList=Object.assign([],s.userList);let e=Object.assign([],s.query);for(let s=e.length-1;s>=0;s--)e[s].hasURL=this.includeUrl(e[s].message),!0===e[s].hasURL&&(e[s].messageArray=e[s].message.split(/(https?:\/\/[^\s]+| +)/g)),this.message.push(e[s]);this.setBottom(!0)}}))},sendMessage(){""!=this.$refs.sayInput.value&&(this.ws.binaryType="blob",this.ws.send(this.$refs.sayInput.value)),this.$refs.sayInput.value="",this.$refs.sayInput.focus()},closeConnection(){1===this.ws.readyState&&this.ws.close()},setBottom(e=!1){let s=100;var t=document.getElementById("chat-board");let i=Math.ceil(t.scrollTop+t.clientHeight);(this.scrollHeightTemp<=i+s&&this.scrollHeightTemp>=i-s||e)&&(t.scrollTop=Math.ceil(t.scrollHeight-t.clientHeight)),this.scrollHeightTemp=t.scrollHeight},activeDate(e){e.isDate=!e.isDate}},beforeRouteLeave(e,s,t){this.closeConnection(),t()},mounted(){this.connection(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(document.querySelector(".chat-board").style.height=window.innerHeight-140+"px",console.log(window.innerHeight)),this.isOnlineListActive()},updated(){this.setBottom()}},C=t(89);const H=(0,C.Z)(x,[["render",D],["__scopeId","data-v-4775cb3e"]]);var O=H}}]);
//# sourceMappingURL=323.abdeabe8.js.map